## 嵌软第三次任务

### TIM

#### 知识学习

1.定时器分类，三种计时器的区别

* STM32的计时器分为外设定时器和内核定时器，包含了高级定时器、通用计时器、基本定时器、看门狗定时器、实时时钟、低功耗定时器。

* 基本定时器：几乎没有任何输入输出通道，常用作时基，实现基本定时、计数功能。

  通用定时器：具备多路独立捕获和比较的通道，可以完成定时/计数、输入捕获、输出比较等功能。

  高级定时器：除通用计时器功能外，还具备带死区控制的互补信号输出等高级功能。用于电机控制和数字电源设计。

2. 自设的定时器
   * 我使用的单片机是F411CEU8。配有1个16位高级定时器（TIM1)、2个32位通用计时器、5个16位通用定时器(TIM2/TIM5,TIM3/TIM4,TIM9,TIM10/TIM11)。

3. 时钟树
   * SYSCLK可以由三个时钟源提供，分别是HSI、HSE、PLLCLK。
   * SYSCLK通过AHB Prescaler得到HCLK。
   * STM32中总线时钟有AHB、APB1、APB2。

4. 概念解释
   * 定时器时钟源：定时器运行的时基依据。
   * 计数器时钟：时钟即为固定频率、占空比的稳定PWM波。计时器时钟则为计时器的时钟输入。
   * 计数器：本质上即为触发器的组合电路，不仅可以对时钟脉冲计数，还可以用于分频、定时、产生序列脉冲等。
   * 自动重载寄存器：即ARR，用来存放与计数器所记数值相比较的值，若两值相等则直接产生更新或中断。在pwm波中与预分频系数共同决定其频率。

5. 如何计算定时时间

   ​    定时时间=计数值（定时值）\* 机器周期= 计数值（定时值）\* 12 / 晶振频率

#### 实验工程

配置较为顺利，led闪烁状态也是之前任务所完成的内容，按部就班地完成了。



### PWM

#### 知识学习

1. 什么是脉冲宽度调制

   本质上是一种通过对一系列脉冲的宽度进行调制来等效获得所需要的波形，从而利用数字对模拟电路进行控制的有效技术。

2. 定时器在pwm输出模式下如何产生pwm波

   参照时钟根据一定频率定时中断来交替输出高低电平从而产生pwm波。

3. 如何产生特定频率占空比的pwm波

   Fpwm = 时钟频率 / ((arr+1)*(psc+1))

   duty circle = TIMX->CCR1 / arr

#### 实验工程

由于已经在驱动电机，便直接使用了蓝牙模块进行串口通信。频率占空比的更新收发采用了dma实现不定长收发，用缓冲区参数使用compare和reload函数进行占空比和频率的更新。
